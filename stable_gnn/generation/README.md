# Graph Generator с использованием Large Language Models (LLM)

## Оглавление
1. [Описание проекта](#описание-проекта)
2. [Теоретическая справка](#теоретическая-справка)
    - [Графы и гиперграфы](#графы-и-гиперграфы)
    - [Использование Large Language Models для генерации графов](#использование-large-language-models-для-генерации-графов)
3. [Возможности](#возможности)
4. [Установка](#установка)
    - [Требования](#требования)
    - [Шаги установки](#шаги-установки)
5. [Использование](#использование)
    - [Примеры](#примеры)
6. [Тестирование](#тестирование)
---

## Описание проекта

**Graph Generator** — это инструмент для автоматической генерации графов и гиперграфов из текстовых данных с использованием современных больших языковых моделей (LLM). Проект позволяет анализировать текст, выделять ключевые сущности и их взаимосвязи, представляя их в виде структурированных графовых данных. Это может быть полезно для различных областей, включая анализ текста, обработку естественного языка, исследование социальных сетей и многое другое.

Основные компоненты проекта:

- **LLMClient**: Клиент для взаимодействия с языковой моделью через API Ollama.
- **FineTuneClient**: Клиент для тонкой настройки моделей с использованием библиотеки Transformers.
- **DataProcessor**: Инструменты для предварительной обработки текстовых данных.
- **Тесты**: Набор модульных тестов для обеспечения корректной работы всех компонентов.

---

## Теоретическая справка

### Графы и гиперграфы

**Граф** — это математическая структура, состоящая из множества узлов (вершин) и множества рёбер, которые соединяют пары узлов. Графы широко используются для моделирования различных систем и процессов, таких как социальные сети, транспортные системы, биологические сети и многое другое.

**Гиперграф** расширяет концепцию графа, позволяя рёбрам соединять любое количество узлов, а не только пары. Эти рёбра называются гиперрёбрами. Гиперграфы полезны для моделирования более сложных взаимосвязей, где взаимодействие может включать более чем два элемента одновременно, например, группы людей или совместные действия.

### Использование Large Language Models для генерации графов

Большие языковые модели (LLM), такие как GPT-4, обладают способностью понимать и генерировать текст на естественном языке. Используя эти модели, можно автоматически извлекать ключевые сущности и их взаимосвязи из неструктурированных текстовых данных и представлять их в виде графов или гиперграфов. Это включает следующие шаги:

1. **Предварительная обработка текста**: Очистка и подготовка текста для анализа.
2. **Извлечение сущностей**: Определение ключевых элементов (например, персонажей, мест, событий) из текста.
3. **Определение связей**: Анализ контекста для выявления взаимосвязей между сущностями.
4. **Построение графа/гиперграфа**: Представление извлечённых сущностей и связей в виде графовой структуры.

Использование LLM для этих задач позволяет автоматизировать процесс анализа текста, повышая эффективность и точность по сравнению с ручным анализом.

---

## Возможности

- **Автоматическое создание графов**: Извлечение сущностей и связей из текста для построения графов.
- **Генерация гиперграфов**: Формирование более сложных структур с гиперрёбрами для моделирования множественных взаимосвязей.
- **Тонкая настройка моделей**: Возможность адаптации моделей под специфические задачи или домены.
- **Модульное тестирование**: Обеспечение качества и надёжности через набор модульных тестов.
---

## Установка

### Требования

Перед установкой убедитесь, что у вас установлены следующие компоненты:

- **Python**: Версия 3.10 или выше.
- **pip**: Менеджер пакетов для Python.
- Аппаратные требования:

    - GPU NVIDIA H100: Для выполнения инференса и тонкой настройки моделей требуется доступ к GPU NVIDIA H100, обеспечивающему высокую производительность и эффективность обработки.
    - CUDA: Убедитесь, что на вашем устройстве установлены совместимые версии CUDA и драйверов NVIDIA для работы с GPU H100.

### Шаги установки


1. **Создание виртуального окружения (рекомендуется)**

    ```bash
    python3 -m venv venv
    source venv/bin/activate  # Для Linux/Mac
    venv\Scripts\activate     # Для Windows
    ```

2. **Установка зависимостей**

    Установите зависимости с помощью pip:

    ```bash
    pip install -r requirements.txt
    ```
---

## Использование

### Примеры

#### Генерация графа из текста

```python
from graph_generator.core.llm_client import LLMClient
from graph_generator.core.data_processor import DataProcessor

# Инициализация клиента
data_processor = DataProcessor()
llm_client = LLMClient(model="mistral:7b", data_processor=data_processor)

# Входной текст
text = "Алексей встретился с Иваном в парке. Они поехали на концерт, а потом встретили Анну."

# Генерация графа
graph_description = llm_client.generate_graph_description(text)
print(graph_description)
```

**Ожидаемый вывод:**

```json
{
    "Алексей": ["Иван", "Анна"],
    "Иван": ["Алексей", "Анна"],
    "Анна": ["Иван", "Алексей"]
}
```

#### Генерация гиперграфа из текста

```python
from graph_generator.core.llm_client import LLMClient
from graph_generator.core.data_processor import DataProcessor

# Инициализация клиента
data_processor = DataProcessor()
llm_client = LLMClient(model="mistral:7b", data_processor=data_processor)

# Входной текст
text = "Алексей, Иван и Анна поехали на концерт, а после этого все встретились в кафе."

# Генерация гиперграфа
hypergraph_description = llm_client.generate_hypergraph_description(text)
print(hypergraph_description)
```

**Ожидаемый вывод:**

```json
{
    "hyperedge_1": ["Алексей", "Иван", "Анна"]
}
```

---

## Тестирование

Проект включает набор модульных тестов для обеспечения корректной работы всех компонентов. Тесты написаны с использованием `pytest` и включают мокирование внешних вызовов к API Ollama.

### Запуск тестов

1. **Убедитесь, что виртуальное окружение активировано и все зависимости установлены.**

2. **Выполните команду для запуска всех тестов:**

    ```bash
    pytest graph_generator/tests/
    ```

3. **Ожидаемый результат:**

    Все тесты должны пройти успешно, что подтверждает корректную работу клиентов и обработку различных типов ответов от Ollama.

    ```plaintext
    =========================================== test session starts ============================================
    platform linux -- Python 3.10.15, pytest-8.3.4, pluggy-1.5.0
    rootdir: /path/to/graph-generator
    collected 8 items

    graph_generator/tests/llm_test.py ........                                                        [100%]

    ============================================ 8 passed in 0.12s =============================================
    ```

### Описание тестов

- **`test_generate_graph_description`**: Проверяет успешную генерацию графа с корректным ответом от Ollama.
- **`test_generate_hypergraph_description`**: Проверяет успешную генерацию гиперграфа с корректным ответом от Ollama.
- **`test_generate_graph_description_invalid_response`**: Проверяет обработку некорректного ответа от Ollama при генерации графа.
- **`test_generate_hypergraph_description_invalid_response`**: Проверяет обработку некорректного ответа от Ollama при генерации гиперграфа.
- **`test_generate_graph_description_empty_response`**: Проверяет обработку пустого ответа от Ollama при генерации графа.
- **`test_generate_hypergraph_description_empty_response`**: Проверяет обработку пустого ответа от Ollama при генерации гиперграфа.
- **`test_retry_on_invalid_response`**: Проверяет логику повторных попыток при получении некорректного ответа для генерации графа.
- **`test_retry_on_empty_response`**: Проверяет логику повторных попыток при получении пустого ответа для генерации графа.

---

